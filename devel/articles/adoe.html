<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="admiralophtha">
<title>Creating ADOE â€¢ admiralophtha</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating ADOE">
<meta property="og:description" content="admiralophtha">
<meta property="og:image" content="https://pharmaverse.github.io/admiralophtha/devel/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">admiralophtha</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/admiralophtha.html">Get Started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-user-guides">User Guides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-user-guides">
    <a class="dropdown-item" href="../articles/adoe.html">Creating ADOE</a>
    <a class="dropdown-item" href="../articles/adbcva.html">Creating ADBCVA</a>
    <a class="dropdown-item" href="../articles/advfq.html">Creating ADVFQ</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pharmaverse/admiralophtha" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="adoe_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Creating ADOE</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiralophtha/blob/main/vignettes/adoe.Rmd" class="external-link"><code>vignettes/adoe.Rmd</code></a></small>
      <div class="d-none name"><code>adoe.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This article describes creating an <code>ADOE</code> ADaM with common ophthalmology endpoint parameters.</p>
<p>This article is yet to be written. Use as basis the <code>{admiralonco}</code> article for <code>ADRS</code> (commented out in the file for now).</p>
<!-- **Note**: *All examples assume CDISC SDTM and/or ADaM format as input unless -->
<!-- otherwise specified.* -->
<!-- ## Required Packages -->
<!-- The examples of this vignette require the following packages. -->
<!-- ```{r, warning=FALSE, message=FALSE} -->
<!-- library(admiral) -->
<!-- ``` -->
<!-- # Programming Workflow -->
<!-- * [Read in Data](#readdata) -->
<!-- * [Derive Parameters (`CNSR`, `ADT`, `STARTDT`)](#parameters) -->
<!-- * [Derive Analysis Value (`AVAL`)](#aval) -->
<!-- * [Derive Analysis Sequence Number (`ASEQ`)](#aseq) -->
<!-- * [Add ADSL Variables](#adslvars) -->
<!-- ## Read in Data {#readdata} -->
<!-- To start, all datasets needed for the creation of the time-to-event dataset -->
<!-- should be read into the environment. This will be a company specific process. -->
<!-- For example purpose, the ADaM datasets---which are included -->
<!-- in `{admiral}` and `{admiralonco}`---are used. An alternative might be to use -->
<!-- `ADEVENT` as input. -->
<!-- ```{r} -->
<!-- data("admiral_adsl") -->
<!-- data("admiral_adrs") -->
<!-- adsl <- admiral_adsl -->
<!-- adrs <- admiral_adrs -->
<!-- ``` -->
<!-- ## Derive Parameters (`CNSR`, `ADT`, `STARTDT`) {#parameters} -->
<!-- To derive the parameter dependent variables like `CNSR`, `ADT`, `STARTDT`, -->
<!-- `EVNTDESC`, `SRCDOM`, `PARAMCD`, ... the `admiral::derive_param_tte()` function can be -->
<!-- used. It adds one parameter to the input dataset with one observation per -->
<!-- subject. Usually it is called several times. -->
<!-- For each subject it is determined if an event occurred. In the affirmative the -->
<!-- analysis date `ADT` is set to the earliest event date. If no event occurred, the -->
<!-- analysis date is set to the latest censoring date. -->
<!-- The events and censorings are defined by the `admiral::event_source()` and the -->
<!-- `admiral::censor_source()` class respectively. It defines -->
<!-- - which observations (`filter` parameter) of a source dataset (`dataset_name` -->
<!-- parameter) are potential events or censorings, -->
<!-- - the value of the `CNSR` variable (`censor` parameter), and -->
<!-- - which variable provides the date (`date` parameter). -->
<!-- The date can be provided as date (`--DT` variable), datetime (`--DTM` variable), -->
<!-- or character ISO-8601 date (`--DTC` variable). -->
<!-- CDISC strongly recommends `CNSR = 0` for events and positive integers for -->
<!-- censorings. `{admiral}`/`{admiralonco}` enforce this recommendation. Therefore the `censor` -->
<!-- parameter is available for `admiral::censor_source()` only. It is defaulted to `1`. -->
<!-- The `dataset_name` parameter expects a character value which is used as an -->
<!-- identifier. The actual data which is used for the derivation of the parameter is -->
<!-- provided via the `source_datasets` parameter of `admiral::derive_param_tte()`. It expects -->
<!-- a named list of datasets. The names correspond to the identifiers specified for -->
<!-- the `dataset_name` parameter. This allows to define events and censoring -->
<!-- independent of the data. -->
<!-- ### Pre-Defined Time-to-Event Source Objects -->
<!-- The table below shows all pre-defined `tte_source` objects which should cover the most -->
<!-- common oncology use cases. -->
<!-- ```{r echo=FALSE} -->
<!-- knitr::kable(list_tte_source_objects(package = "admiralonco")) -->
<!-- ``` -->
<!-- As mentioned in the introduction, each company would create their own version of this with -->
<!-- the required filtering conditions and metadata as per your company approach. An example of -->
<!-- a possible different approach could be as follows, where death is sourced from `ADSL`, -->
<!-- instead of `ADRS`, and the given `EVNTDESC` is different. -->
<!-- ```{r, eval=FALSE} -->
<!-- adsl_death_event <- event_source( -->
<!--   dataset_name = "adsl", -->
<!--   date = DTHDT, -->
<!--   set_values_to = vars( -->
<!--     EVNTDESC = "STUDY DEATH", -->
<!--     SRCDOM = "ADSL", -->
<!--     SRCVAR = "DTHDT" -->
<!--   ) -->
<!-- ) -->
<!-- ``` -->
<!-- An optional step at this stage would be required to enable derivation of duration of -->
<!-- response: If using `ADRS` / `ADEVENT` parameters as input for any response dates -->
<!-- (instead of a variable in `ADSL`) then you would need to use `admiral::derive_vars_merged()` -->
<!-- to add the response date as a temporary variable (e.g. `TEMP_RESPDT`) to be able to feed -->
<!-- into `admiral::derive_param_tte()` as the start date. You would also need to use this -->
<!-- to filter the input datasets so as to only derive the records for responders. -->
<!-- This could also be repeated as needed for IRF/BICR and confirmed responses. -->
<!-- Here is an example of the code needed. -->
<!-- ```{r} -->
<!-- adsl <- adsl %>% -->
<!--   derive_vars_merged( -->
<!--     dataset_add = adrs, -->
<!--     filter_add = PARAMCD == "RSP" & AVALC == "Y" & ANL01FL == "Y", -->
<!--     by_vars = vars(STUDYID, USUBJID), -->
<!--     new_vars = vars(TEMP_RESPDT = ADT) -->
<!--   ) -->
<!-- adrs <- adrs %>% -->
<!--   derive_vars_merged( -->
<!--     dataset_add = adsl, -->
<!--     by_vars = vars(STUDYID, USUBJID), -->
<!--     new_vars = vars(TEMP_RESPDT) -->
<!--   ) -->
<!-- ``` -->
<!-- The pre-defined objects can be passed directly to `admiral::derive_param_tte()` to create -->
<!-- a new time-to-event parameter. Below shows example calls for Overall Survival (OS), Progression -->
<!-- Free Survival (PFS), and duration of response (as above, this is only derived for responder -->
<!-- patients so we have to filter source datasets). Note that the reason for including a -->
<!-- randomization date censor is to catch those patients that never have a tumor assessment. -->
<!-- ```{r} -->
<!-- adtte <- derive_param_tte( -->
<!--   dataset_adsl = adsl, -->
<!--   start_date = RANDDT, -->
<!--   event_conditions = list(death_event), -->
<!--   censor_conditions = list(lastalive_censor, rand_censor), -->
<!--   source_datasets = list(adsl = adsl, adrs = adrs), -->
<!--   set_values_to = vars(PARAMCD = "OS", PARAM = "Overall Survival") -->
<!-- ) %>% -->
<!--   derive_param_tte( -->
<!--     dataset_adsl = adsl, -->
<!--     start_date = RANDDT, -->
<!--     event_conditions = list(pd_event, death_event), -->
<!--     censor_conditions = list(lasta_censor, rand_censor), -->
<!--     source_datasets = list(adsl = adsl, adrs = adrs), -->
<!--     set_values_to = vars(PARAMCD = "PFS", PARAM = "Progression Free Survival") -->
<!--   ) %>% -->
<!--   derive_param_tte( -->
<!--     dataset_adsl = adsl, -->
<!--     start_date = TEMP_RESPDT, -->
<!--     event_conditions = list(pd_event, death_event), -->
<!--     censor_conditions = list(lasta_censor), -->
<!--     source_datasets = list(adsl = filter(adsl, !is.na(TEMP_RESPDT)), adrs = filter(adrs, !is.na(TEMP_RESPDT))), -->
<!--     set_values_to = vars(PARAMCD = "RSD", PARAM = "Duration of Response") -->
<!--   ) -->
<!-- ``` -->
<!-- ```{r, echo=FALSE} -->
<!-- dataset_vignette( -->
<!--   adtte, -->
<!--   display_vars = vars(USUBJID, PARAMCD, PARAM, STARTDT, ADT, CNSR) -->
<!-- ) -->
<!-- ``` -->
<!-- ### Creating Your Own Time-to-Event Source Objects -->
<!-- We advise you consult the `{admiral}` -->
<!-- [Creating a BDS Time-to-Event ADaM vignette](https://pharmaverse.github.io/admiral/articles/bds_tte.html) -->
<!-- for further guidance on the different options available and more examples. -->
<!-- One extra common oncology case we include here is around PFS when censoring -->
<!-- at new anti-cancer therapy. This could either be controlled using `ANLzzFL` as -->
<!-- explained in the ADRS vignette, so that records after new anti-cancer therapy -->
<!-- never contribute to the PD and DEATH parameters. Or alternatively you can control -->
<!-- this on the ADTTE side by filtering which records are used in -->
<!-- `admiral::event_source()` and `admiral::censor_source()`, e.g. for PD or death -->
<!-- event date we can use `filter` argument to exclude events occurring after new -->
<!-- anti-cancer therapy. -->
<!-- The censor could be set as whichever date your analysis requires, -->
<!-- e.g. date of last tumor assessment prior to new anti-cancer therapy or last -->
<!-- radiological assessment. If you pass multiple censor dates then remember the -->
<!-- function will choose the latest occurring of these, so be cautious here if -->
<!-- feeding in say one censor date for last assessment prior to new anti-cancer -->
<!-- therapy and one for last assessment - as the function would choose the maximum of -->
<!-- these which in this case would be incorrect. The easiest solution here would be -->
<!-- to pass in one censor date as the date of last assessment prior to new -->
<!-- anti-cancer therapy or date of last assessment **if no new anti-cancer therapy**. -->
<!-- If you wanted to use different censor dates which could have different `CNSDTDSC` -->
<!-- values, then you'd need to ensure only one is set per patient. -->
<!-- This case is demonstrated in the below example (where `NACTDT` would be -->
<!-- pre-derived as first date of new anti-cancer therapy, and `LASTANDT` as the -->
<!-- single tumor assessment censor date as described above). -->
<!-- ```{r, eval=FALSE} -->
<!-- pd_nact_event <- event_source( -->
<!--   dataset_name = "adsl", -->
<!--   filter = PDDT < NACTDT | is.na(NACTDT), -->
<!--   date = PDDT, -->
<!--   set_values_to = vars( -->
<!--     EVNTDESC = "Disease Progression prior to NACT", -->
<!--     SRCDOM = "ADSL", -->
<!--     SRCVAR = "PDDT" -->
<!--   ) -->
<!-- ) -->
<!-- death_nact_event <- event_source( -->
<!--   dataset_name = "adsl", -->
<!--   filter = DTHDT < NACTDT | is.na(NACTDT), -->
<!--   date = DTHDT, -->
<!--   set_values_to = vars( -->
<!--     EVNTDESC = "Death prior to NACT", -->
<!--     SRCDOM = "ADSL", -->
<!--     SRCVAR = "DTHDT" -->
<!--   ) -->
<!-- ) -->
<!-- lasta_nact_censor <- censor_source( -->
<!--   dataset_name = "adsl", -->
<!--   date = LASTANDT, -->
<!--   set_values_to = vars( -->
<!--     EVNTDESC = "Last Tumor Assessment prior to NACT", -->
<!--     CNSDTDSC = "Last Tumor Assessment prior to NACT", -->
<!--     SRCDOM = "ADSL", -->
<!--     SRCVAR = "LASTANDT" -->
<!--   ) -->
<!-- ) -->
<!-- adtte <- derive_param_tte( -->
<!--   dataset_adsl = adsl, -->
<!--   start_date = RANDDT, -->
<!--   event_conditions = list(pd_nact_event, death_nact_event), -->
<!--   censor_conditions = list(lasta_nact_censor, rand_censor), -->
<!--   source_datasets = list(adsl = adsl), -->
<!--   set_values_to = vars(PARAMCD = "PFSNACT", PARAM = "Progression Free Survival prior to NACT") -->
<!-- ) -->
<!-- ``` -->
<!-- ## Derive Analysis Value (`AVAL`) {#aval} -->
<!-- The analysis value (`AVAL`) can be derived by calling `admiral::derive_vars_duration()`. -->
<!-- This example derives the time to event in days.  -->
<!-- ```{r eval=TRUE} -->
<!-- adtte <- adtte %>% -->
<!--   derive_vars_duration( -->
<!--     new_var = AVAL, -->
<!--     start_date = STARTDT, -->
<!--     end_date = ADT -->
<!--   ) -->
<!-- ``` -->
<!-- ```{r, echo=FALSE} -->
<!-- dataset_vignette( -->
<!--   adtte -->
<!-- ) -->
<!-- ``` -->
<!-- Other time units, such as months that we commonly see in oncology analyses, can be requested -->
<!-- by specifying the `out_unit` parameter. See the example below. Note that because of the underlying -->
<!-- `lubridate::time_length()` function that is used here this may perform slightly differently to -->
<!-- your expectations, e.g. both `time_length(ymd("2021-01-01") %--% ymd("2021-02-01"), "month")` -->
<!-- and `time_length(ymd("2021-02-01") %--% ymd("2021-03-01"), "month")` results in exactly 1 month, -->
<!-- which is a logical approach but it gives a different result to the convention of assuming every -->
<!-- month has exactly equal days and just using `/30.4375` here or some other such convention. The -->
<!-- difference would only be noticed for small durations, but if the user prefers an alternative -->
<!-- approach they could calculate in the default days and then add extra processing to convert to months -->
<!-- with their company-specific convention. -->
<!-- ```{r, eval=FALSE} -->
<!-- adtte_months <- adtte %>% -->
<!--   derive_vars_duration( -->
<!--     new_var = AVAL, -->
<!--     start_date = STARTDT, -->
<!--     end_date = ADT, -->
<!--     out_unit = "months" -->
<!--   ) -->
<!-- ``` -->
<!-- ## Derive Analysis Sequence Number (`ASEQ`) {#aseq} -->
<!-- The `{admiral}` function `admiral::derive_var_obs_number()` can be used to derive `ASEQ`: -->
<!-- ```{r eval=TRUE} -->
<!-- adtte <- adtte %>% -->
<!--   derive_var_obs_number( -->
<!--     by_vars = vars(STUDYID, USUBJID), -->
<!--     order = vars(PARAMCD), -->
<!--     check_type = "error" -->
<!--   ) -->
<!-- ``` -->
<!-- ```{r, echo=FALSE} -->
<!-- dataset_vignette(adtte) -->
<!-- ``` -->
<!-- ## Add ADSL Variables {#adslvars} -->
<!-- Variables from ADSL which are required for time-to-event analyses, e.g., -->
<!-- treatment variables or covariates can be added using `admiral::derive_vars_merged()`. -->
<!-- ```{r eval=TRUE} -->
<!-- adtte <- adtte %>% -->
<!--   derive_vars_merged( -->
<!--     dataset_add = adsl, -->
<!--     new_vars = vars(ARMCD, ARM, ACTARMCD, ACTARM, AGE, SEX), -->
<!--     by_vars = vars(STUDYID, USUBJID) -->
<!--   ) -->
<!-- ``` -->
<!-- ```{r, echo=FALSE} -->
<!-- dataset_vignette( -->
<!--   adtte, -->
<!--   display_vars = vars(USUBJID, PARAMCD, CNSR, AVAL, ARMCD, AGE, SEX) -->
<!-- ) -->
<!-- ``` -->
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Edoardo Mancini, Gordon Miller, Lucy Palmen, Rachel Linacre.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
